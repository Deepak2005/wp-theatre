// Generated by CoffeeScript 1.7.1

/*
--------------------------------------------
     Begin editor.coffee
--------------------------------------------
 */

(function() {
  var wpt_admin_ticketspage, wpt_editor, wpt_production, wpt_productions;

  wpt_editor = (function() {
    function wpt_editor(editor) {
      this.editor = editor;
      this.productions = new wpt_productions(this.editor);
    }

    return wpt_editor;

  })();

  wpt_productions = (function() {
    function wpt_productions(editor) {
      this.editor = editor;
      this.placeholder = this.editor.find('.wpt_editor_productions');
      this.productions = [];
      this.load();
    }

    wpt_productions.prototype.load = function() {
      var data;
      data = {
        'action': 'productions'
      };
      return jQuery.post(wpt_editor_ajax.url, data, (function(_this) {
        return function(response) {
          var production, _i, _len;
          for (_i = 0, _len = response.length; _i < _len; _i++) {
            production = response[_i];
            _this.productions.push(new wpt_production(production));
          }
          return _this.update();
        };
      })(this));
    };

    wpt_productions.prototype.update = function() {
      var production, _i, _len, _ref, _results;
      this.placeholder.empty();
      _ref = this.productions;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        production = _ref[_i];
        _results.push(this.placeholder.append(production.html()));
      }
      return _results;
    };

    return wpt_productions;

  })();

  wpt_production = (function() {
    function wpt_production(production) {
      this.production = production;
    }

    wpt_production.prototype.html = function() {
      var html;
      html = '<div class="wpt_editor_production">';
      html += '<div class="wpt_editor_production_actions">';
      html += '<a class="wpt_production_editor_view" href="">View</a>';
      html += '<a class="wpt_production_editor_delete" href="">Delete</a>';
      html += '<a class="wpt_production_editor_edit" href="">Edit</a>';
      html += '</div>';
      html += '<div class="wpt_editor_production_meta">';
      html += '<div class="wpt_editor_production_dates">' + this.production['dates'] + '</div>';
      html += '<div class="wpt_editor_production_cities">' + this.production['cities'] + '</div>';
      html += '<div class="wpt_editor_production_categories">' + this.production['categories'] + '</div>';
      html += '<div class="wpt_editor_production_season">' + this.production['season'] + '</div>';
      html += '</div>';
      html += '<h2>' + this.production['title'] + '</h2>';
      html += '<div>' + this.production['excerpt'] + '</div>';
      html += '<p>' + this.production[wpt_editor_ajax.order_key] + '</p>';
      html += '</div>';
      return html;
    };

    wpt_production.prototype.edit = function() {};

    wpt_production.prototype.save = function() {};

    return wpt_production;

  })();

  jQuery(function() {
    return jQuery('.wpt_editor').each(function() {
      return new wpt_editor(jQuery(this));
    });
  });


  /*
  --------------------------------------------
       Begin admin.coffee
  --------------------------------------------
   */

  wpt_admin_ticketspage = (function() {
    function wpt_admin_ticketspage() {
      this.ticketspage = jQuery('select#iframepage').parents('tr');
      this.integrationstypes = jQuery("input[name='wpt_tickets[integrationtype]']");
      if (this.ticketspage.length > 0 && this.integrationstypes.length > 0) {
        this.update();
        this.integrationstypes.click((function(_this) {
          return function() {
            return _this.update();
          };
        })(this));
      }
    }

    wpt_admin_ticketspage.prototype.update = function() {
      var integrationtype;
      integrationtype = jQuery("input[name='wpt_tickets[integrationtype]']:checked").val();
      if (integrationtype === 'iframe') {
        return this.ticketspage.show(1000);
      } else {
        return this.ticketspage.hide(500);
      }
    };

    return wpt_admin_ticketspage;

  })();

  jQuery(function() {
    wpt_admin_ticketspage = new wpt_admin_ticketspage;

    /*
    	Enable datepicker in event admin form.
     */
    jQuery('.wp_theatre_datepicker').datetimepicker({
      dateFormat: 'yy-mm-dd',
      timeFormat: 'HH:mm:ss'
    });

    /*
    	Update all connected events when bulk updating productions.
    	See: http://codex.wordpress.org/Plugin_API/Action_Reference/bulk_edit_custom_box
     */
    return jQuery('#bulk_edit').live('click', function() {
      var bulk_row, post_ids, post_status;
      bulk_row = jQuery('#bulk-edit');
      post_ids = new Array();
      bulk_row.find('#bulk-titles').children().each(function() {
        return post_ids.push(jQuery(this).attr('id').replace(/^(ttle)/i, ''));
      });
      post_status = bulk_row.find('select[name="_status"]').val();
      return jQuery.ajax({
        url: ajaxurl,
        type: 'POST',
        async: false,
        cache: false,
        data: {
          action: 'save_bulk_edit_wp_theatre_prod',
          post_ids: post_ids,
          post_status: post_status
        }
      });
    });
  });

}).call(this);
